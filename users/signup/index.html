<!DOCTYPE html>
<html lang="en">
<meta charset="UTF-8">

<link rel="icon" type="image/x-icon" href="escape.png">
<title>Is this what you wanted?</title>
<link rel="stylesheet" href="overlay.css">

<style>
body {
        background-color: black;
        font-family: Arial, Helvetica, sans-serif;
}
#div_principal{
    background-image: url('vaporwave2.jpg');
    background-repeat: no-repeat;
    background-attachment: fixed; 
    background-size: 80% 100%;
    background-position: center center;
    padding-top: 100px;
    padding-bottom: 76px;
    margin: auto;
    border: 3px solid black;
    width: 75%;
}
#div_secundaria{
    background-image: url('vaporwave2.gif');
    background-repeat: no-repeat;
    width: 33%;
    padding: 10px;
    margin-left: 14%;
    margin-top: 5%;
    border: 3px solid black;
}
input, select, button{
    background-color: #f5f5f5;
    border-radius: 10px;
}
::-webkit-color-swatch{
  border:none;
}
</style>


<body id="body">
    <audio id="musica_fundo" loop><source src="vaporwave.mp3" type="audio/mpeg"></audio>

    <div id="myNav" class="overlay">
        <center>
        <p style="color: white;font-size: 80px;">Are you sure?</p>
        <div style="letter-spacing: 200px;">
            <button style="cursor: wait;font-size: 25px;" title="take your time" onclick="closeNav();musica_fundo.play()">Yes</button>
            <button onclick="xau()" style="cursor: wait;font-size: 25px;" title="It's the safer option" >No</button>
        </div>
        </center>
    </div>
    
    <div id="div_principal">
        <div id="div_secundaria">

            <label for="nome" id="teste1">Nome:</label><br>
            <input required type="text" name="nome" id="nome" ><br><br>
            <label for="email">Email:</label><br>
            <input required type="email" name="email" id="email"><br><br>
            <label for="pass">Palavra-chave:</label><br>  
            <input required type="password" name="pass" id="pass"><br><br>
            <label for="pass2">Confirma palavra-chave:</label><br>
            <input required type="password" name="pass2" id="pass2"><br><br>
            <label for="vibes">Vibe:</label><br>
            <select required style="width: 45%;" name="vibe" id="vibe" >
                <option disabled selected>-- select an option --</option>
                <option value="1">https://ricadinho.com/</option>
                <option value="2">ok</option>
                <option value="3">VÌµÌÍƒÌŽÌÍ Í‘Í Í’Ì©Í‰Í‡Í”ÍˆÌªÍ‡Ì¬Ì©Í…IÌ¶Í‘Ì»ÌºBÌ¶Ì…Í‘Ì“ÌšÍ€ÌÌŽÌŒÌ†Ì Í™Í™Ì¢ÌŸÌ¡Í”Ì¹Ì¡EÌµÍ‹Í„Í‚ÍƒÌÌÍƒÍ‘ÌŠÌ‹ÍÌÌšÍÌ¹Ì¨ÍšÌ«Í…ÍŽÍ•Ì¢Í™Ì ÌºÌ³SÌ¸Í’Í’Ì½ÌžÍ‰Ì¡Ì¯Ì–Ì³Ì¨ÌžÌœÌ¨Ì¼Ì¯Ì¯</option>
                <option value="4">A tua mãe</option>
                <option value="5">H9CW+873، شارع بني مكَيد، الدار البيضاء 20250، المغرب</option>
                <option value="6" style="font-size: 22px;">&#8734;</option>
                <option value="7">https://tenor.com/view/homer-the-simpsons-dance-wiggle-gif-17689048</option>
                <option value="8">&#x1F919;</option>
                <option value="9">MVG™</option>
                <option value="10">&#9742;&#9742;&#9742; &#128483; &#x1F57D;</option>
                <option value="11">36.651017º, -115.694683º</option>
                <option value="12">A321 XLR</option>
                <option value="13">&#128191;&#128191;&#128191;</option>
                <option value="13">A minha mãe</option>
                <option value="14">3a012798-2d6b-4cda-a314-12dab8363d81</option>
                <option value="15"><strong>&#8469;&#120140;&#120131;&#120131;</strong></option>
                <option value="16">Não</option>
                <option value="17">GET THAT BRODA OF MY PHONE &#x1F57D;</option>
            </select><br><br>
            <label for="cor">Cor favorita:</label><br>
            <input  oninput="mudar(event)" required type="color" value="#F5F5F5" name="cor" id="input_cor" style="width: 45%;"><br><br>
            
            <button onclick="signup()" id="submeter">Join us</button><br><br>
            <div id="message"></div>
            
        </div>
    </div> 
</body>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script>

    document.getElementById("myNav").style.display = "block";

    var musica_fundo = document.getElementById("musica_fundo");
    var div_principal = document.getElementById("div_principal");
    var div_secundaria = document.getElementById("div_secundaria");
    var input_cor = document.getElementById("input_cor");
    var input_nome = document.getElementById("nome");
    var input_email = document.getElementById("email");
    var input_pass = document.getElementById("pass");
    var input_pass2 = document.getElementById("pass2");
    var input_vibe = document.getElementById("vibe");
    var submeter = document.getElementById("submeter");
    var body = document.getElementById("body");
    var messageDiv = document.getElementById('message');

    function mudar(ev){
        const color = input_cor.value;//ev.target.value;
        //console.log(input_cor.value);
        //console.log(r,b,g);
        var r = parseInt(color.substr(1,2), 16);
        var g = parseInt(color.substr(3,2), 16);
        var b = parseInt(color.substr(5,2), 16);

        div_secundaria.style.color = "rgb("+r+","+g+","+b+")";
        input_nome.style.backgroundColor = "rgb("+r+","+g+","+b+")";
        input_email.style.backgroundColor = "rgb("+r+","+g+","+b+")";
        input_pass.style.backgroundColor = "rgb("+r+","+g+","+b+")";
        input_pass2.style.backgroundColor = "rgb("+r+","+g+","+b+")";
        input_vibe.style.backgroundColor = "rgb("+r+","+g+","+b+")";
        submeter.style.backgroundColor = "rgb("+r+","+g+","+b+")";
        input_cor.style.backgroundColor = "rgb("+r+","+g+","+b+")";
        body.style.backgroundColor = "rgb("+r+","+g+","+b+")";
        
        r = 255 - parseInt(color.substr(1,2), 16);
        g = 255 - parseInt(color.substr(3,2), 16);
        b = 255 - parseInt(color.substr(5,2), 16);

        div_principal.style.borderColor = "rgb("+r+","+g+","+b+")";
        div_secundaria.style.borderColor = "rgb("+r+","+g+","+b+")";
        input_nome.style.color = "rgb("+r+","+g+","+b+")";
        input_email.style.color = "rgb("+r+","+g+","+b+")";
        input_pass.style.color = "rgb("+r+","+g+","+b+")";
        input_pass2.style.color = "rgb("+r+","+g+","+b+")";
        input_vibe.style.color = "rgb("+r+","+g+","+b+")";
        submeter.style.color = "rgb("+r+","+g+","+b+")";
        input_nome.style.borderColor = "rgb("+r+","+g+","+b+")";
        input_email.style.borderColor = "rgb("+r+","+g+","+b+")";
        input_pass.style.borderColor = "rgb("+r+","+g+","+b+")";
        input_pass2.style.borderColor = "rgb("+r+","+g+","+b+")";
        input_vibe.style.borderColor = "rgb("+r+","+g+","+b+")";
        submeter.style.borderColor = "rgb("+r+","+g+","+b+")";
        input_cor.style.borderColor = "rgb("+r+","+g+","+b+")";
    }

    function closeNav() {
        document.getElementById("myNav").style.display = "none";
    }

    function xau(){
        window.location.href = 'https://ricadinho.com/';    
    }

    function check(){
      console.log(input_nome.value)
      console.log(input_email.value)
      console.log(input_vibe.options[input_vibe.selectedIndex].text)
      console.log(input_cor.value)
        if(input_nome.value.toString().length < 3){
          return "nome tem de ter mais de 2 caracteres"
        }else if(input_pass.value != input_pass2.value){
          return "passes nao sao iguais"
        }else if(input_vibe.options[input_vibe.selectedIndex].text == "-- select an option --"){
          return "Vibe?"
        }else{
          return "nada"
        }
    }


    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxianJyZXNneGdpd3JsbWh6cm1tIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUwOTk0MTYsImV4cCI6MjA2MDY3NTQxNn0.ZrivsC43W6kBegY7r4dwZB_pTRUZJgBU5GzBsDNQiq4'
    const SUPABASE_URL = 'https://lbjrresgxgiwrlmhzrmm.supabase.co';

    const { createClient } = supabase;
    const client = createClient(SUPABASE_URL, SUPABASE_KEY);

    async function signup() {

      var msg_erro = check()
      if (msg_erro!="nada"){
        messageDiv.textContent = msg_erro;
        console.error('erro no check():', msg_erro);
        return;
      }

      const email = input_email.value
      const nome_signup = input_nome.value
      const cor_signup = input_cor.value
      const vibe_signup = input_vibe.options[input_vibe.selectedIndex].text
      const password = input_pass.value


      const { data: NomeExise } = await client
      .from('users')
      .select('*')
      .eq('nome', nome_signup)
      .single();

      if (NomeExise) {
        messageDiv.textContent = nome_signup+' is already taken';
        return;
      }


      const { data, error } = await client.auth.signUp({ email, password });

      if (error) {
        messageDiv.textContent = error.message;
        console.error('Signup error:', error);
        return;
      }

      if (data.user) {
        const { error: insertError } = await client
          .from('users') // Replace with your actual table name
          .insert([
            {
              nome: nome_signup,
              email: email,
              vibe: vibe_signup,
              cor_favorita: cor_signup
              // id and data_criacao will auto-generate
            }
          ]);

        if (insertError) {
          messageDiv.textContent = insertError.message;
          console.error('Insert error:', insertError);
        } else {
          messageDiv.textContent = 'Welcome to your new reality, CHECK YOUR EMAIL!';
          console.log('User and profile saved!');
        }
      }
    }

</script>



</html>